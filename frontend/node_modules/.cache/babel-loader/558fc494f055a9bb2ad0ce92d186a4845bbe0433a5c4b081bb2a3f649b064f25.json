{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{w3cwebsocket as W3CWebSocket}from\"websocket\";import{useNavigate}from\"react-router-dom\";import{useMessage}from'../../Components/MessageContext';import{jsx as _jsx}from\"react/jsx-runtime\";const WebSocketComponent=()=>{const[isConnecting,setIsConnecting]=useState(true);const navigate=useNavigate();const{socket,setSocket,USBList,setUSBList,wifiSSID,setwifiSSID,wifiPassword,setwifiPassword,fourG_apn,setfourG_apn,fourG_user,setfourG_user,fourG_password,setfourG_password,fourG_pin,setfourG_pin,items,setItems,containerRef}=useMessage();const handleAddItem=(message,isSuccess)=>{setItems(prevItems=>[...prevItems,{message,isSuccess}]);if(containerRef.current){setTimeout(()=>{containerRef.current.scrollTop=containerRef.current.scrollHeight;},0);}};const Tick=()=>{return/*#__PURE__*/_jsx(\"img\",{className:\"tick\",src:\"/assets/img/tik.png\",alt:\"\"});};const connectWebSocket=()=>{console.log(\"Web\",isConnecting);// if (isConnecting) return;\nsetIsConnecting(true);const newSocket=new W3CWebSocket('ws://'+window.location.hostname+':4000');newSocket.onopen=()=>{console.log(\"WebSocket bağlantısı kuruldu.\");navigate(\"\");setSocket(newSocket);setIsConnecting(false);};newSocket.onmessage=message=>{const jsonData=JSON.parse(message.data.toString());console.log(jsonData);switch(jsonData.Command){case\"USBList\":setUSBList(jsonData.Data);break;case\"Config\":if(jsonData.Data){setwifiSSID(jsonData.Data.wifiSSID);setwifiPassword(jsonData.Data.wifiPassword);setfourG_apn(jsonData.Data.fourG_apn);setfourG_user(jsonData.Data.fourG_user);setfourG_password(jsonData.Data.fourG_password);setfourG_pin(jsonData.Data.fourG_pin);}break;case\"USBControl\":if(jsonData.Data){console.log(\"Test cihazına bağlandı\");handleAddItem(\"Test cihazına bağlandı.\",true);handleAddItem(\"Test cihazının hazır olması bekleniyor...\",null);}else{console.log(\"Test cihazına bağlanamadı\");handleAddItem(\"Test cihazına bağlanamadı!.\",false);}break;case\"TestDevice\":if(jsonData.Data){handleAddItem(\"Test cihazı hazır.\",true);}}};newSocket.onerror=error=>{console.error(\"WebSocket hatası:\",error);};newSocket.onclose=()=>{console.log(\"WebSocket bağlantısı kapatıldı.\");setSocket(null);setIsConnecting(false);setTimeout(()=>{connectWebSocket();},1000);};};useEffect(()=>{const fetchData=async()=>{try{console.log(\"connectWebSocket...\");connectWebSocket();}catch(error){console.error(\"Error fetching data:\",error);}};fetchData();return()=>{if(socket){console.log(\"WebSocket bağlantısı kapatıldı.\");socket.close();}};},[]);return/*#__PURE__*/_jsx(\"div\",{});};export default WebSocketComponent;","map":{"version":3,"names":["React","useEffect","useState","w3cwebsocket","W3CWebSocket","useNavigate","useMessage","jsx","_jsx","WebSocketComponent","isConnecting","setIsConnecting","navigate","socket","setSocket","USBList","setUSBList","wifiSSID","setwifiSSID","wifiPassword","setwifiPassword","fourG_apn","setfourG_apn","fourG_user","setfourG_user","fourG_password","setfourG_password","fourG_pin","setfourG_pin","items","setItems","containerRef","handleAddItem","message","isSuccess","prevItems","current","setTimeout","scrollTop","scrollHeight","Tick","className","src","alt","connectWebSocket","console","log","newSocket","window","location","hostname","onopen","onmessage","jsonData","JSON","parse","data","toString","Command","Data","onerror","error","onclose","fetchData","close"],"sources":["C:/Users/syucedag/Desktop/all_projects/sevda/mygit/testApplication/frontend/src/Components/WebSocketComponent/index.tsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { w3cwebsocket as W3CWebSocket } from \"websocket\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport LoadingProduct from \"../../assets/icons/loadingProduct.svg\";\r\nimport { useMessage } from '../../Components/MessageContext';\r\n\r\ninterface Item {\r\n  message: string;\r\n  isSuccess: boolean | null;\r\n}\r\n\r\nconst WebSocketComponent = () => {\r\n  const [isConnecting, setIsConnecting] = useState(true);\r\n  const navigate = useNavigate();\r\n\r\n  const {\r\n    socket,\r\n    setSocket,\r\n    USBList,\r\n    setUSBList,\r\n    wifiSSID,\r\n    setwifiSSID,\r\n    wifiPassword,\r\n    setwifiPassword,\r\n    fourG_apn,\r\n    setfourG_apn,\r\n    fourG_user,\r\n    setfourG_user,\r\n    fourG_password,\r\n    setfourG_password,\r\n    fourG_pin,\r\n    setfourG_pin,\r\n    items,\r\n    setItems,\r\n    containerRef,\r\n  } = useMessage();\r\n\r\n  const handleAddItem = (message: string, isSuccess: boolean | null) => {\r\n    setItems((prevItems: Item[]) => [\r\n      ...prevItems, \r\n      { message, isSuccess }, \r\n    ]);\r\n\r\n    if (containerRef.current) {\r\n      setTimeout(() => {\r\n        containerRef.current!.scrollTop = containerRef.current!.scrollHeight;\r\n      }, 0);\r\n    }\r\n  };\r\n\r\n\r\n  const Tick = () => {\r\n    return <img className=\"tick\" src=\"/assets/img/tik.png\" alt=\"\" />\r\n  };\r\n\r\n  const connectWebSocket = () => {\r\n    console.log(\"Web\", isConnecting)\r\n    // if (isConnecting) return;\r\n\r\n    setIsConnecting(true);\r\n\r\n\r\n    const newSocket = new W3CWebSocket('ws://' + window.location.hostname + ':4000');\r\n\r\n    newSocket.onopen = () => {\r\n      console.log(\"WebSocket bağlantısı kuruldu.\");\r\n      navigate(\"\");\r\n      setSocket(newSocket);\r\n      setIsConnecting(false);\r\n    };\r\n\r\n    newSocket.onmessage = (message) => {\r\n      const jsonData = JSON.parse(message.data.toString());\r\n      console.log(jsonData);\r\n      switch (jsonData.Command) {\r\n        case \"USBList\":\r\n          setUSBList(jsonData.Data)\r\n          break\r\n        case \"Config\":\r\n          if (jsonData.Data) {\r\n            setwifiSSID(jsonData.Data.wifiSSID)\r\n            setwifiPassword(jsonData.Data.wifiPassword)\r\n            setfourG_apn(jsonData.Data.fourG_apn)\r\n            setfourG_user(jsonData.Data.fourG_user)\r\n            setfourG_password(jsonData.Data.fourG_password)\r\n            setfourG_pin(jsonData.Data.fourG_pin)\r\n          }\r\n          break\r\n        case \"USBControl\":\r\n          if (jsonData.Data) {\r\n            console.log(\"Test cihazına bağlandı\")\r\n            handleAddItem(\"Test cihazına bağlandı.\", true)\r\n            handleAddItem(\"Test cihazının hazır olması bekleniyor...\", null)\r\n          }\r\n          else {\r\n            console.log(\"Test cihazına bağlanamadı\")\r\n            handleAddItem(\"Test cihazına bağlanamadı!.\", false)\r\n          }\r\n          break\r\n        case \"TestDevice\":\r\n          if (jsonData.Data) {\r\n            handleAddItem(\"Test cihazı hazır.\", true)\r\n          }\r\n\r\n\r\n      }\r\n\r\n    };\r\n\r\n    newSocket.onerror = (error) => {\r\n      console.error(\"WebSocket hatası:\", error);\r\n    };\r\n\r\n    newSocket.onclose = () => {\r\n      console.log(\"WebSocket bağlantısı kapatıldı.\");\r\n      setSocket(null);\r\n      setIsConnecting(false);\r\n\r\n      setTimeout(() => {\r\n        connectWebSocket();\r\n      }, 1000);\r\n    };\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        console.log(\"connectWebSocket...\")\r\n        connectWebSocket();\r\n      } catch (error) {\r\n        console.error(\"Error fetching data:\", error);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n\r\n    return () => {\r\n      if (socket) {\r\n        console.log(\"WebSocket bağlantısı kapatıldı.\");\r\n        socket.close();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  return <div></div>;\r\n};\r\n\r\nexport default WebSocketComponent;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}